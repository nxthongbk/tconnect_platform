import { Marker, MarkerDragEvent } from 'react-map-gl';
import IconPhosphor from '~/assets/iconPhosphor';
import './style.scss';
import { noop } from 'lodash';
import { useDownloadFileAvatar } from '~/utils/hooks/useHandleFileAvatar';
import { Avatar } from '@mui/material';

interface IProps {
  longitude: number;
  latitude: number;
  status: string;
  onClick?: (e: any) => void;
  draggable?: boolean;
  onDragEnd?: (e: MarkerDragEvent) => void;
  onDragStart?: (e: MarkerDragEvent) => void;
  popup?: unknown;
  style?: any;
  avatarUrl?: string;
  name?: string;
  ipAddress?: string;
}


export default function MarkerMap({
  longitude,
  latitude,
  onClick,
  status,
  draggable = false,
  onDragEnd = noop,
  onDragStart = noop,
  popup,
  style,
  avatarUrl,
  name,
  ipAddress,
}: IProps) {
  const { imageUrl } = useDownloadFileAvatar(avatarUrl);

  const renderElement = () => {
    switch (status) {
      case 'ALARM':
        return (
          <div className='pulse'>
            {imageUrl ? <Avatar src={imageUrl} /> : <IconPhosphor iconName='FireSimple' size={30} weight='fill' color='white' />}
          </div>
        );
        break;
      case 'ACTIVE':
      case 'CONFIRM':
      case 'IGNORE':
        return (
          <div>
            {name && ipAddress && (
              <div className="marker-info-box">
                <div className="name">{name}</div>
                <div className="ip">{ipAddress}</div>
              </div>
            )}
            <svg className="green-blink" width="64" height="77" viewBox="0 0 64 77" fill="none" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <clipPath id="circle-clip">
                  <circle cx="32" cy="29" r="16" />
                </clipPath>
                <filter
                  id="filter0_d_21192_112087"
                  x="0"
                  y="0"
                  width="64"
                  height="77"
                  filterUnits="userSpaceOnUse"
                  colorInterpolationFilters="sRGB"
                >
                  <feFlood floodOpacity="0" result="BackgroundImageFix" />
                  <feColorMatrix
                    in="SourceAlpha"
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                    result="hardAlpha"
                  />
                  <feOffset dy="2" />
                  <feGaussianBlur stdDeviation="6" />
                  <feComposite in2="hardAlpha" operator="out" />
                  <feColorMatrix
                    type="matrix"
                    values="0 0 0 0 0.117647 0 0 0 0 0.12549 0 0 0 0 0.12549 0 0 0 0.12 0"
                  />
                  <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_21192_112087" />
                  <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_21192_112087" result="shape" />
                </filter>
              </defs>
              <g filter="url(#filter0_d_21192_112087)">
                <path
                  d="M51.5 29.4853C51.5 31.6204 50.8097 34.217 49.656 37.0517C48.5055 39.8786 46.9097 42.9048 45.1342 45.8878C41.5834 51.8537 37.3359 57.61 34.559 61.1968C33.2393 62.9014 30.742 62.9101 29.4123 61.2143C26.6308 57.6672 22.3907 51.9798 18.8485 46.0368C17.0773 43.0652 15.4862 40.039 14.3391 37.1911C13.1892 34.3364 12.5 31.6957 12.5 29.4853C12.5 19.0122 21.2181 10.5 32 10.5C42.7819 10.5 51.5 19.0122 51.5 29.4853Z"
                  fill="#1FAD68"
                  stroke="#188B54"
                />
                <rect x="16" y="13" width="32" height="32" rx="16" fill="white" />
                {imageUrl ? (
                  <image
                    href={imageUrl}
                    x="16"
                    y="13"
                    width="32"
                    height="32"
                    preserveAspectRatio="xMidYMid slice"
                    clipPath="url(#circle-clip)"
                  />

                ) : (
                  <path
                    d="M42.4744 36.4998H40.9997V25.9998C40.9997 25.602 40.8417 25.2204 40.5604 24.9391C40.2791 24.6578 39.8975 24.4998 39.4997 24.4998H35.3747C35.2752 24.4998 35.1799 24.5393 35.1095 24.6096C35.0392 24.68 34.9997 24.7753 34.9997 24.8748V36.4998H33.4997V20.0382C33.5022 19.8046 33.4515 19.5735 33.3514 19.3623C33.2514 19.1512 33.1046 18.9655 32.9222 18.8195C32.6736 18.6257 32.3702 18.5151 32.0552 18.5035C31.7401 18.4918 31.4294 18.5798 31.1672 18.7548L23.6672 23.7498C23.4615 23.8871 23.2928 24.0731 23.1764 24.2913C23.0599 24.5095 22.9992 24.7531 22.9997 25.0004V36.4998H21.525C21.3312 36.4969 21.1435 36.5676 20.9996 36.6975C20.8558 36.8274 20.7665 37.007 20.7497 37.2001C20.7429 37.3027 20.7572 37.4056 20.7919 37.5024C20.8265 37.5992 20.8807 37.6879 20.951 37.7629C21.0213 37.8379 21.1063 37.8976 21.2007 37.9384C21.2951 37.9791 21.3969 38 21.4997 37.9998H42.4997C42.6025 38 42.7043 37.9791 42.7987 37.9384C42.8931 37.8976 42.9781 37.8379 43.0484 37.7629C43.1187 37.6879 43.1729 37.5992 43.2075 37.5024C43.2422 37.4056 43.2565 37.3027 43.2497 37.2001C43.2329 37.007 43.1436 36.8274 42.9997 36.6975C42.8559 36.5676 42.6682 36.4969 42.4744 36.4998Z"
                    fill="#1FAD68"
                  />
                )}

              </g>
            </svg>

          </div>
        );
        break;
      case 'PENDING':
        return (
          <div>
            <svg width='94' height='77' viewBox='0 0 64 77' fill='none' xmlns='http://www.w3.org/2000/svg'>
              <g filter='url(#filter0_d_21192_112087)'>
                <path
                  d='M51.5 29.4853C51.5 31.6204 50.8097 34.217 49.656 37.0517C48.5055 39.8786 46.9097 42.9048 45.1342 45.8878C41.5834 51.8537 37.3359 57.61 34.559 61.1968C33.2393 62.9014 30.742 62.9101 29.4123 61.2143C26.6308 57.6672 22.3907 51.9798 18.8485 46.0368C17.0773 43.0652 15.4862 40.039 14.3391 37.1911C13.1892 34.3364 12.5 31.6957 12.5 29.4853C12.5 19.0122 21.2181 10.5 32 10.5C42.7819 10.5 51.5 19.0122 51.5 29.4853Z'
                  fill='#F57200'
                  stroke='#A34C00'
                  strokeWidth='3px'
                />
                <rect x='16' y='13' width='32' height='32' rx='16' fill='white' />
                <path
                  d='M42.4744 36.4998H40.9997V25.9998C40.9997 25.602 40.8417 25.2204 40.5604 24.9391C40.2791 24.6578 39.8975 24.4998 39.4997 24.4998H35.3747C35.2752 24.4998 35.1799 24.5393 35.1095 24.6096C35.0392 24.68 34.9997 24.7753 34.9997 24.8748V36.4998H33.4997V20.0382C33.5022 19.8046 33.4515 19.5735 33.3514 19.3623C33.2514 19.1512 33.1046 18.9655 32.9222 18.8195C32.6736 18.6257 32.3702 18.5151 32.0552 18.5035C31.7401 18.4918 31.4294 18.5798 31.1672 18.7548L23.6672 23.7498C23.4615 23.8871 23.2928 24.0731 23.1764 24.2913C23.0599 24.5095 22.9992 24.7531 22.9997 25.0004V36.4998H21.525C21.3312 36.4969 21.1435 36.5676 20.9996 36.6975C20.8558 36.8274 20.7665 37.007 20.7497 37.2001C20.7429 37.3027 20.7572 37.4056 20.7919 37.5024C20.8265 37.5992 20.8807 37.6879 20.951 37.7629C21.0213 37.8379 21.1063 37.8976 21.2007 37.9384C21.2951 37.9791 21.3969 38 21.4997 37.9998H42.4997C42.6025 38 42.7043 37.9791 42.7987 37.9384C42.8931 37.8976 42.9781 37.8379 43.0484 37.7629C43.1187 37.6879 43.1729 37.5992 43.2075 37.5024C43.2422 37.4056 43.2565 37.3027 43.2497 37.2001C43.2329 37.007 43.1436 36.8274 42.9997 36.6975C42.8559 36.5676 42.6682 36.4969 42.4744 36.4998ZM27.1247 34.2498C27.1249 34.3526 27.104 34.4544 27.0632 34.5488C27.0225 34.6432 26.9628 34.7282 26.8878 34.7985C26.8128 34.8688 26.7241 34.923 26.6273 34.9576C26.5305 34.9923 26.4276 35.0066 26.325 34.9998C26.1317 34.983 25.952 34.8936 25.8221 34.7495C25.6921 34.6055 25.6216 34.4175 25.6247 34.2236V32.7751C25.6221 32.5814 25.6928 32.3938 25.8227 32.25C25.9525 32.1062 26.132 32.0168 26.325 31.9998C26.4276 31.993 26.5305 32.0073 26.6273 32.042C26.7241 32.0766 26.8128 32.1308 26.8878 32.2011C26.9628 32.2714 27.0225 32.3564 27.0632 32.4508C27.104 32.5452 27.1249 32.647 27.1247 32.7498V34.2498ZM27.1247 28.9998C27.1249 29.1026 27.104 29.2044 27.0632 29.2988C27.0225 29.3932 26.9628 29.4782 26.8878 29.5485C26.8128 29.6188 26.7241 29.673 26.6273 29.7076C26.5305 29.7423 26.4276 29.7566 26.325 29.7498C26.1318 29.7328 25.9522 29.6433 25.8223 29.4993C25.6924 29.3553 25.6218 29.1675 25.6247 28.9736V27.5251C25.6221 27.3314 25.6928 27.1438 25.8227 27C25.9525 26.8562 26.132 26.7668 26.325 26.7498C26.4276 26.743 26.5305 26.7573 26.6273 26.792C26.7241 26.8266 26.8128 26.8808 26.8878 26.9511C26.9628 27.0214 27.0225 27.1064 27.0632 27.2008C27.104 27.2952 27.1249 27.397 27.1247 27.4998V28.9998ZM30.8747 34.2498C30.8749 34.3526 30.854 34.4544 30.8132 34.5488C30.7725 34.6432 30.7128 34.7282 30.6378 34.7985C30.5628 34.8688 30.4741 34.923 30.3773 34.9576C30.2805 34.9923 30.1776 35.0066 30.075 34.9998C29.8821 34.983 29.7026 34.8938 29.5727 34.7502C29.4428 34.6066 29.3721 34.4191 29.3747 34.2254V32.7751C29.3723 32.5815 29.4431 32.3942 29.573 32.2506C29.7028 32.107 29.8821 32.0177 30.075 32.0007C30.1776 31.9939 30.2805 32.0083 30.3773 32.0429C30.4741 32.0775 30.5628 32.1317 30.6378 32.202C30.7128 32.2724 30.7725 32.3574 30.8132 32.4518C30.854 32.5462 30.8749 32.6479 30.8747 32.7507V34.2498ZM30.8747 28.9998C30.8749 29.1026 30.854 29.2044 30.8132 29.2988C30.7725 29.3932 30.7128 29.4782 30.6378 29.5485C30.5628 29.6188 30.4741 29.673 30.3773 29.7076C30.2805 29.7423 30.1776 29.7566 30.075 29.7498C29.8821 29.7328 29.7028 29.6436 29.573 29.5C29.4431 29.3564 29.3723 29.169 29.3747 28.9754V27.5251C29.3723 27.3315 29.4431 27.1442 29.573 27.0006C29.7028 26.857 29.8821 26.7677 30.075 26.7507C30.1776 26.7439 30.2805 26.7583 30.3773 26.7929C30.4741 26.8275 30.5628 26.8817 30.6378 26.952C30.7128 27.0224 30.7725 27.1074 30.8132 27.2018C30.854 27.2962 30.8749 27.3979 30.8747 27.5007V28.9998Z'
                  fill='#F57200'
                />
              </g>
              <defs>
                <filter
                  id='filter0_d_21192_112087'
                  x='0'
                  y='0'
                  width='64'
                  height='77'
                  filterUnits='userSpaceOnUse'
                  color-interpolation-filters='sRGB'
                >
                  <feFlood flood-opacity='0' result='BackgroundImageFix' />
                  <feColorMatrix
                    in='SourceAlpha'
                    type='matrix'
                    values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0'
                    result='hardAlpha'
                  />
                  <feOffset dy='2' />
                  <feGaussianBlur stdDeviation='6' />
                  <feComposite in2='hardAlpha' operator='out' />
                  <feColorMatrix type='matrix' values='0 0 0 0 0.117647 0 0 0 0 0.12549 0 0 0 0 0.12549 0 0 0 0.12 0' />
                  <feBlend mode='normal' in2='BackgroundImageFix' result='effect1_dropShadow_21192_112087' />
                  <feBlend mode='normal' in='SourceGraphic' in2='effect1_dropShadow_21192_112087' result='shape' />
                </filter>
              </defs>
            </svg>
          </div>
        );
      default:
        return null;
    }
  };
  return (
    <Marker
      longitude={longitude}
      latitude={latitude}
      anchor='bottom'
      onClick={onClick}
      draggable={draggable}
      onDragStart={onDragStart}
      onDragEnd={onDragEnd}
      popup={popup}
      style={style}
    >
      {renderElement()}
    </Marker>
  );
}
